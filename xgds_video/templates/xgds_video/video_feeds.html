{% extends "base.html" %}
{% block headExtras %}
{{block.super}}
 <script src="{{ STATIC_URL }}javascript/AC_QuickTime.js" language="javascript" type="text/javascript"></script>
 <script src="{{ STATIC_URL }}jquery/js/masonry.pkgd.min.js" type="text/javascript"></script>
 <script src="{{ STATIC_URL }}jquery/js/jquery.js" type="text/javascript"></script>
 <script src="{{STATIC_URL}}external/js/jquery-ui-1.8.18.custom.js" type="text/javascript" ></script>
 <script src="{{STATIC_URL}}external/js/jquery.tagsinput.js" type="text/javascript" ></script>
 <script src="{{STATIC_URL}}external/js/jquery.form.min.js" type="text/javascript" ></script>
 <script type="text/javascript">var submitNoteUrl = '{% url record_simple %}'</script>
 <script src="{{STATIC_URL}}xgds_video/js/video_notes_form.js" type="text/javascript" ></script>
 {% endblock headExtras %}
{% load nav %}
{% block siteSection %}Video{% endblock %}
    {% block nav %}
    {% nav "video.live" %}
    {{ block.super }}
    {% endblock %}
    
    {% block sitemenu-content-secondary %}
	{% include "xgds_video/video_subnav.html" %}
    {% endblock %}
	
{% block contents %}

<script language="javascript" type="text/javascript">
function getMaxWidth() {
	  var width = window.innerWidth ||
    			  document.documentElement.clientWidth ||
    			  document.body.clientWidth;
	  {% if videoFeedData|length > 1 %}
	  			width = Math.round(width/2);
	  {% endif %}
	  
	  width = width - 100;
	  return width;
}

function calculateSize(newWidth, defaultHeight, defaultWidth) {
	 var resultHeight = defaultHeight;
	 var resultWidth = newWidth;
	 // the default size of the video is bigger than the new size so we have to scale up.
    if (defaultWidth > newWidth){
        ratio = newWidth / defaultWidth
        resultHeight = Math.round(defaultHeight * ratio)
        resultWidth = Math.round(defaultWidth * ratio)
    } else if (newWidth > defaultWidth) {
   	 // the default size of the video is bigger than the new size so we have to cap it
        resultHeight = defaultHeight
        resultWidth = defaultWidth
    }
    return [resultWidth, resultHeight];
}

var maxWidth = getMaxWidth();
</script>

<div id="container" class="js-masonry" data-masonry-options='{  "itemSelector": ".item", "gutter":5}'>
{% for feed, form in videoFeedData %}
<script language="javascript" type="text/javascript">
	  var size = calculateSize(maxWidth, {{ feed.settings.height }}, {{ feed.settings.width  }});
</script>
<div class="item" id="item{{ forloop.counter }}" style="background:#CACACA;  margin-bottom: 5px; padding: 8px;border-style:solid; border-width:2px;">
	<div style="float:left; text-align: left"><b>Live feed: {{ feed.name }}</b></div>
	<div style="float:right; text-align: right; padding-bottom:3px;"><a class="mybutton" href="{% url xgds_video_live feed.shortName %}">New Window</a>&nbsp;&nbsp;
		<a class="mybutton" href="{% url xgds_video_recorded %}?source={{ feed.source.shortName }}">Recorded</a></div>
	{% include "xgds_video/video_notes.html" with data=form %}
	<script language="javascript" type="text/javascript">
	  $("#item{{ forloop.counter }}").css({"width":size[0],"height":size[1]+100}); 
	  QT_WriteOBJECT('https://plrp.xgds.org/static/{{ feed.name }}Stream.mov',  '100%', /* feedHeight */'100%', '', 'AUTOPLAY',
	                 'True', 'qtsrc', '{{ feed.url }}', 'AutoHREF', 'True', 'SCALE', 'Aspect', 'EnableJavaScript', 'True', 'Controller', 'False', 'TARGET', 'Myself',
	                 'emb#NAME' , 'movie{{ forloop.counter }}');
	</script>
	
</div>
{% endfor %}
</div>
{% endblock %}

{% block scripts %}
{% endblock scripts %}


{% block cssExtras %}
 {{ block.super }}
<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}jquery/css/jquery-ui.css"></link>
<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}external/css/jquery.tagsinput.css"></link>
<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}external/css/jquery-ui-1.8.18.custom.css"></link>
<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}xgds_video/style/xgds_video.css"></link>
{% endblock cssExtras %}

{% block jsInit %}
//prepare the form when the DOM is ready 
$(document).ready(function() { 
	{% for feed, form in videoFeedData %}
	
	   // bind form using 'ajaxForm' 
       $('#create_note{{ form.index }}').ajaxForm(options);
       
       // bind the fancy tags for each form
	    $('form#create_note{{ form.index }} #id_tags').tagsInput({
		    width: '200px',
		    height: '12px',
		    autocomplete_url: '{% url note_tags_list %}'
			});
			
		$('#id_tags_tag').blur(function(e) {
		    if (! $(this).data('autocomplete_active')) {
		        if ($(this).attr('value') && $(this).attr('value') != 'add a tag') {
		            $('form#create_note{{ form.index }} #id_tags').addTag($(this).attr('value'));
		        }
		    }
		});

    {% endfor %}
    
    $('#page-content').on(
	    'autocompletefocus',
	    'input.ui-autocomplete-input',
	    function() {
	        $(this).data('autocomplete_active', true);
	    }
	).on(
	    'autocompleteclose',
	    'input.ui-autocomplete-input',
	    function() {
	        $(this).data('autocomplete_active', false);
	    }
);
}); 
{% endblock jsInit %}


